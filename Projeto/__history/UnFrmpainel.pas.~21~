unit UnFrmpainel;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, Menus, ExtCtrls, jpeg;

type
  TFRMPAINEL = class(TForm)
    MainMenu1: TMainMenu;
    NFCe1: TMenuItem;
    Impressora1: TMenuItem;
    DetectarImpressora1: TMenuItem;
    estarImpressora1: TMenuItem;
    Contingncia1: TMenuItem;
    VerificarArquivos1: TMenuItem;
    EnviarContingncia1: TMenuItem;
    Panel1: TPanel;
    Caixa1: TMenuItem;
    ExtratoMovimento1: TMenuItem;
    OutrosMtodos1: TMenuItem;
    AjustarDatHora1: TMenuItem;
    Servidor1: TMenuItem;
    ReImprimiraUltimaNFCe1: TMenuItem;
    Cadastros1: TMenuItem;
    CadastrodeProdutos1: TMenuItem;
    CadastrodeClientes1: TMenuItem;
    CadastrodeVendedores1: TMenuItem;
    NotasEmitidas1: TMenuItem;
    Image1: TImage;
    procedure DetectarImpressora1Click(Sender: TObject);
    procedure estarImpressora1Click(Sender: TObject);
    procedure VerificarArquivos1Click(Sender: TObject);
    procedure EnviarContingncia1Click(Sender: TObject);
    procedure ExtratoMovimento1Click(Sender: TObject);
    procedure AjustarDatHora1Click(Sender: TObject);
    procedure Servidor1Click(Sender: TObject);
    procedure ReImprimiraUltimaNFCe1Click(Sender: TObject);
    procedure CadastrodeProdutos1Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
     iRetorno: Integer;
  end;

var
  FRMPAINEL: TFRMPAINEL;

implementation

uses UnFrmpdv, UnFrmmenurelcaixa, Unfrmcadproduto, Unfrmmtcestoque;

{$R *.dfm}

procedure TFRMPAINEL.AjustarDatHora1Click(Sender: TObject);
begin
  iRetorno := eAjustarDataHora_NFCe_Daruma();
  frmpdv.TrataRetorno_NFCe(iRetorno);
end;

procedure TFRMPAINEL.CadastrodeProdutos1Click(Sender: TObject);
begin
FRMMTCPRODUTOS:= TFRMMTCPRODUTOS.Create(Self);
FRMMTCPRODUTOS.ShowModal;
end;

procedure TFRMPAINEL.DetectarImpressora1Click(Sender: TObject);
var
   StrPorta: string;
   StrVelocidade: string;

begin
  StrPorta:= StringOfChar(' ',20);
  StrVelocidade:= StringOfChar(' ',20);

  iRetorno:= eBuscarPortaVelocidade_DUAL_DarumaFramework();

  if(iRetorno = 1) then
    begin
      iRetorno:= regRetornaValorChave_DarumaFramework('DUAL','Velocidade', StrVelocidade);
      iRetorno:= regRetornaValorChave_DarumaFramework('DUAL','PortaComunicacao', StrPorta);
      ShowMessage('Comunicação estabelecida! Porta: ' + StrPorta +  ' Velocidade: ' + StrVelocidade);
    end
   else
    begin
      ShowMessage('Erro ao estabelecer comunicação!');
    end



end;

procedure TFRMPAINEL.EnviarContingncia1Click(Sender: TObject);
var
    StrNumArq: String;
    iQtdDocsContingencia : Integer;
    StrCodAvisoErro: string;
    StrMsgAvisoErro: string;

begin
  StrNumArq:= InputBox('Enviar as Notas em ContingenciaOffline', 'Informe a quantidade de arquivos que deseja enviar (se 0, envia todos os arquivos):', '0');
  if (StrNumArq <> '') then
  begin
    iQtdDocsContingencia := StrToInt(StrNumArq);
    iRetorno := tEnviarContingenciaOffline_NFCe_Daruma(iQtdDocsContingencia);
    frmpdv.TrataRetorno_NFCe(iRetorno);



  end
  else
    Application.MessageBox('Operação cancelada pelo usuário!', 'DarumaFramework Retorno do Método', mb_ok);



end;

procedure TFRMPAINEL.estarImpressora1Click(Sender: TObject);
begin
iRetorno:=iImprimirTexto_DUAL_DarumaFramework('<bmp></bmp>Daruma Developers<l></l>'+
'CNPJ-00.000.000/0000-00   I.E-000000000000<l></l>'+
'Av. Shishima, Urbanova, São José dos Campos-SP<l></l>'+
'------------------------------------------------<l></l>'+
'        DANFE NFC-e - Documento Auxiliar<l></l>'+
'              DOCUMENTO DE TESTE<l></l>'+
'  <b>Não permite aproveitamento de crédito de ICMS</b><l></l>'+
'------------------------------------------------<l></l>'+
'<c>Item  Cod.   Descricao         Qtde Un   VlrUnit   VlrTot</c><l></l>'+
'------------------------------------------------<l></l>'+
'<c>001 123456789098765432  C           53.56 C X 5.25 281.19</c><l></l>'+
'<c>002 123456  Chinelo de dedo de teste para a impressão da DANFE da NFCe dsaldsajdsalkjdsalkadsljkadsjlksdakjlsdakljdasjkladsjkdalsdakj500</c><l></l>'+
'<c>500                  Kg     X 62.30              31150.00</c><l></l>'+
'------------------------------------------------<l></l>'+
'QTD. TOTAL DE ITENS                          002<l></l>'+
'VALOR TOTAL R$                           5143.56<l></l>'+

'FORMA DE PAGAMENTO                    Valor Pago<l></l>'+
'Cheque                                     35.75<l></l>'+
'------------------------------------------------<l></l>'+
'Informação dos Tributos Totais Incidentes(Lei Federal 12.741/2012)                          1,00<l></l>' +
'------------------------------------------------<l></l>'+
'             AREA DE MENSAGEM FISCAL<l></l>'+
'<c>Número:00000089 Série:0 Emissão:00/00/2000 00:00:00 - Via<c><l></l>'+
'<c>                        consumidor</c><l></l>'+
'Consulte pela Chave de Acesso em: http://www.desenvolvedoresdaruma.com.br<l></l>'+
'                 CHAVE DE ACESSO<l></l>'+
'<c>  0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000</c><l></l>'+
'------------------------------------------------<l></l>'+
'                  CONSUMIDOR<l></l>'+
'      CNPJ/CPF/ID Estrangeiro - 00000000000<l></l>'+
'------------------------------------------------<l></l>'+
'         Consulta via leitor de QR Code<l></l>'+
'<ce><qrcode>http://www.desenvolvedoresdaruma.com.br</qrcode></ce><l></l>'+
'<c> Protocolo de Autorização: 99999999 00/00/0000 00:00:00</c><sl>4</sl><gui></gui><l></l>', 0);

   case iRetorno of
    0: Application.MessageBox('[0] - Impressora desligada', 'Daruma DLL Framework', MB_OK + MB_ICONINFORMATION);
    1: Application.MessageBox('[1] - Impressão OK', 'Daruma DLL Framework', MB_OK + MB_ICONINFORMATION);
    -1: Application.MessageBox('[-1] - Arquivo de formato inválido', 'Daruma DLL Framework',MB_OK + MB_ICONINFORMATION);
    -2: Application.MessageBox('[-2] - Arquivo Corrompido/ Erro de Estrutura', 'Daruma DLL Framework', MB_OK + MB_ICONINFORMATION);
    -3: Application.MessageBox('[-3] - BMP não é monocromático', 'Daruma DLL Framework', MB_OK + MB_ICONINFORMATION);
    -4: Application.MessageBox('[-4] - Imagem possui compactação', 'Daruma DLL Framework', MB_OK + MB_ICONINFORMATION);
    -8: Application.MessageBox('[-8] - Não foi possível localizar o arquivo', 'Daruma DLL Framework', MB_OK + MB_ICONINFORMATION);
    -9: Application.MessageBox('[-9] - Não foi possível criar arquivo temporário', 'Daruma DLL Framework', MB_OK + MB_ICONINFORMATION);
    -10: Application.MessageBox('[-10] - Impressora não possui modo gráfico', 'Daruma DLL Framework', MB_OK + MB_ICONINFORMATION);
    -11: Application.MessageBox('[-11] - Impressora matricial, não permite esta impressão', 'Daruma DLL Framework', MB_OK + MB_ICONINFORMATION);
   else
    Application.MessageBox(pchar('Retorno não esperado: ['+ IntToStr(iRetorno)+']'), 'Daruma DLL Framework', mb_ok + 16);
   end;

end;

procedure TFRMPAINEL.ExtratoMovimento1Click(Sender: TObject);
begin
FRMMENURELCAIXA:= TFRMMENURELCAIXA.Create(Self);
FRMMENURELCAIXA.ShowModal;
end;

procedure TFRMPAINEL.ReImprimiraUltimaNFCe1Click(Sender: TObject);
var
    StrParam1: String;
    StrParam2: String;
    StrParam3: String;
begin
  StrParam1 :=''; // EDT_Param1.Text;
  StrParam2 :=''; //EDT_Param2.Text;
  StrParam3 :=''; //EDT_Param3.Text;

  iRetorno := iCFReImprimir_NFCe_Daruma(StrParam1, StrParam2, StrParam3);
  frmpdv.TrataRetorno_NFCe(iRetorno);



end;

procedure TFRMPAINEL.Servidor1Click(Sender: TObject);
begin
  iRetorno:=rStatusWS_NFCe_Daruma();
  case iRetorno of
     1: Application.MessageBox('[1] - Comunicação OK.', 'Light PDV', MB_OK + MB_ICONINFORMATION);
     0: Application.MessageBox('[0] - Erro do método.', 'Light PDV', MB_OK + MB_ICONINFORMATION);
    -1: Application.MessageBox('[-1] - Falha na Comunicação.', 'Light PDV',MB_OK + MB_ICONINFORMATION);
    -2: Application.MessageBox('[-2] - Chave do desenvolvedor inválida.', 'Light PDV', MB_OK + MB_ICONINFORMATION);
    -5: Application.MessageBox('[-5] - Erro Genérico.', 'Light PDV', MB_OK + MB_ICONINFORMATION);
    -8: Application.MessageBox('[-8] - Usuário não Autorizado.', 'Light PDV', MB_OK + MB_ICONINFORMATION);
    -9: Application.MessageBox('[-9] - Usuário não Licenciado.', 'Light PDV', MB_OK + MB_ICONINFORMATION);
   else
    Application.MessageBox(pchar('Retorno não Esperado: ['+ IntToStr(iRetorno)+']'), 'Light PDV', mb_ok + 16);
   end;

end;

procedure TFRMPAINEL.VerificarArquivos1Click(Sender: TObject);
begin
  iRetorno := rNumDocsContingencia_NFCe_Daruma();
  Application.MessageBox( Pchar('Quantidade de Arquivos de Vendas: '+pchar(Trim(IntToStr(iRetorno)))), 'DarumaFramework Retorno do Método', mb_ok);

end;

end.
